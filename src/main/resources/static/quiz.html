<!DOCTYPE html>
<html>
<head>
    <title>Java Online Examination</title>

    <style>
        /* ===== SIMPLE BACKGROUND WITH JAVA WATERMARK ===== */
        body {
            margin: 0;
            height: 100vh;
            font-family: "Segoe UI", Arial, sans-serif;
            background: linear-gradient(135deg, #f0f4ff, #ffffff);
            overflow: hidden;
            position: relative;
        }

        /* Java watermark */
        body::before {
            content: "JAVA";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-25deg);
            font-size: 180px;
            font-weight: bold;
            color: rgba(0, 0, 0, 0.05);
            z-index: 0;
            pointer-events: none;
        }

        /* ===== QUIZ CARD ===== */
        .quiz-box {
            width: 720px;
            margin: auto;
            margin-top: 60px;
            background: rgba(255, 255, 255, 0.96);
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(0,0,0,0.25);
            position: relative;
            z-index: 1;
        }

        .timer {
            position: absolute;
            top: 18px;
            right: 22px;
            color: #dc3545;
            font-weight: bold;
            font-size: 18px;
            background: #fff0f0;
            padding: 6px 14px;
            border-radius: 8px;
        }

        .qno {
            font-weight: bold;
            font-size: 15px;
            color: #555;
            margin-bottom: 10px;
        }

        .question {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 25px;
            color: #111;
        }

        .options label {
            display: block;
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin-bottom: 14px;
            cursor: pointer;
            transition: 0.2s;
            font-size: 16px;
        }

        .options label:hover {
            background: #eef2ff;
            border-color: #667eea;
        }

        .buttons {
            margin-top: 25px;
            display: flex;
            justify-content: space-between;
        }

        button {
            padding: 12px 28px;
            font-size: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #667eea;
            color: white;
        }

        button:disabled {
            background: #aaa;
            cursor: not-allowed;
        }

        .submit-btn {
            display: block;
            margin: 35px auto 0;
            background: #28a745;
        }
    </style>
</head>

<body>

<div class="quiz-box">
    <div class="timer" id="timer">00:00</div>

    <div class="qno" id="qno"></div>
    <div class="question" id="question"></div>
    <div class="options" id="options"></div>

    <div class="buttons">
        <button onclick="prev()">Previous</button>
        <button id="nextBtn" onclick="next()" disabled>Next</button>
    </div>

    <button class="submit-btn" onclick="confirmSubmit()">Submit Exam</button>
</div>

<script>
let questions = [];
let index = 0;
let answers = [];
let timeLeft = 0;
let submitted = false;

/* ENTER FULL SCREEN (BEST EFFORT) */
function openFullScreen() {
    if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen().catch(() => {});
    }
}
openFullScreen();

/* LOAD QUESTIONS */
fetch("/api/questions")
.then(res => res.json())
.then(data => {
    questions = data;
    timeLeft = questions.length * 120;
    loadQuestion();
});

function loadQuestion() {
    let q = questions[index];

    document.getElementById("qno").innerText =
        "Question " + (index + 1) + " of " + questions.length;

    document.getElementById("question").innerText = q.question;

    document.getElementById("options").innerHTML = `
        <label><input type="radio" name="opt" onclick="selectAnswer(0)"> A. ${q.optionA}</label>
        <label><input type="radio" name="opt" onclick="selectAnswer(1)"> B. ${q.optionB}</label>
        <label><input type="radio" name="opt" onclick="selectAnswer(2)"> C. ${q.optionC}</label>
        <label><input type="radio" name="opt" onclick="selectAnswer(3)"> D. ${q.optionD}</label>
    `;

    document.getElementById("nextBtn").disabled = answers[index] == null;
}

function selectAnswer(i) {
    answers[index] = i;
    document.getElementById("nextBtn").disabled = false;
}

function next() {
    if (index < questions.length - 1) {
        index++;
        loadQuestion();
    }
}

function prev() {
    if (index > 0) {
        index--;
        loadQuestion();
    }
}

/* CONFIRM SUBMIT */
function confirmSubmit() {
    if (confirm("Are you sure you want to submit the exam?")) {
        submitQuiz();
    }
}

/* SUBMIT */
function submitQuiz() {
    if (submitted) return;
    submitted = true;

    sessionStorage.setItem("questions", JSON.stringify(questions));
    sessionStorage.setItem("answers", JSON.stringify(answers));
    window.location.href = "result.html";
}

/* TIMER */
setInterval(() => {
    if (submitted) return;

    if (timeLeft <= 0) {
        submitQuiz();
    } else {
        timeLeft--;
        let m = Math.floor(timeLeft / 60);
        let s = timeLeft % 60;
        document.getElementById("timer").innerText =
            m + ":" + (s < 10 ? "0" + s : s);
    }
}, 1000);

/* AUTO SUBMIT ON TAB SWITCH / MINIMIZE */
window.addEventListener("blur", () => {
    submitQuiz();
});
</script>

</body>
</html>
